---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PostCard from '../../components/PostCard.astro';
import DevAddPost from '../../components/dev/DevAddPost.astro';
import { getCollection } from 'astro:content';

const isDev = import.meta.env.DEV;

// Get all non-draft posts, sorted by date
const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const posts = allPosts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<BaseLayout
  title="blog"
  description="random thoughts about random things, explorations"
>
  <section class="page">
    <div class="page-header">
      <h1>blog</h1>
      {isDev && (
        <button class="dev-add-btn" onclick="openDevModal('add-post-modal')" title="New Post">+</button>
      )}
    </div>
    <p class="text-muted page-desc">random thoughts about random things</p>

    <div class="posts-container">
    {posts.length > 0 ? (
      <div class="posts">
        {posts.map(post => (
          <PostCard
            title={post.data.title}
            description={post.data.description}
            pubDate={post.data.pubDate}
            slug={post.slug}
            tags={post.data.tags}
          />
        ))}
      </div>
    ) : (
      <p class="text-muted">No posts yet.</p>
    )}
    </div>
  </section>

  {isDev && <DevAddPost />}
</BaseLayout>

<style>
  .page-header {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    margin-bottom: var(--space-sm);
  }

  .page-desc {
    margin-bottom: var(--space-lg);
  }

  .posts-container {
    margin-top: var(--space-md);
  }

  .dev-add-btn {
    width: 28px;
    height: 28px;
    border-radius: 6px;
    border: 1px dashed var(--border);
    background: transparent;
    color: var(--text-muted);
    font-size: 1.25rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s ease;
  }

  .dev-add-btn:hover {
    border-color: var(--text);
    color: var(--text);
    background: var(--bg-secondary);
  }
</style>
